<!DOCTYPE html>
<html>

<head>
    <title>Schoemans Support Network</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="Images/favicon.png">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
        }

        #map {
            height: 90vh;
            width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: var(--bg);
        }

        .toggle-btn {
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            color: var(--btn-text);
            background: var(--btn-bg);
        }

        :root {
            --bg: #fff;
            --text: #222;
            --btn-bg: #2596be;
            --btn-text: #fff;
            --highlight: rgba(0, 0, 0, 0.3);
        }

        .dark-mode {
            --bg: #1e1e1e;
            --text: #f5f5f5;
            --btn-bg: #3a3a3a;
            --btn-text: #fff;
            --highlight: rgba(255, 255, 255, 0.3);
        }

        .leaflet-popup-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .leaflet-popup-content::-webkit-scrollbar {
            width: 6px;
        }

        .leaflet-popup-content::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 4px;
        }

        .leaflet-popup-content::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }
    </style>
</head>

<body>
    <div class="header">
        <h2>
            <img src="Images/schomans-logo.png" alt="logo" style="height: 60px; width: auto; vertical-align: middle;">
            Schoemans Support Network
        </h2>
        <button id="toggleMode" class="toggle-btn">Switch to Dark Mode</button>
    </div>

    <div id="map"></div>

    <script>
        var map = L.map('map').setView([-22.56, 17.08], 6);

        const lightLayer = L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            { attribution: '© OpenStreetMap contributors' }
        ).addTo(map);

        const darkLayer = L.tileLayer(
            'https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}',
            { maxZoom: 16, attribution: 'Tiles © Esri — Esri, DeLorme, NAVTEQ' }
        );

        const regionCenters = {
            "Hardap": [-24.5, 17.0],
            "Karas": [-27.0, 17.3],
            "Omaheke": [-21.8, 19.2],
            "Otjozondjupa": [-20.5, 17.0],
            "Erongo": [-22.2, 15.0],
            "Kunene": [-19.0, 13.8],
            "Oshikoto": [-18.1, 16.0],
            "Oshana": [-17.8, 15.9],
            "Omusati": [-17.6, 14.9],
            "Ohangwena": [-17.4, 16.3],
            "Kavango West": [-18.2, 18.0],
            "Kavango East": [-18.0, 20.2],
            "Zambezi": [-17.5, 24.3],
            "Khomas": [-22.57, 17.08]
        };

        // Marker icons
        const greenIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Custom red marker (#fc2203)
        const redIcon = L.divIcon({
            className: "",
            html: `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="50" viewBox="0 0 24 40">
              <path fill="#fc2203" stroke="black" stroke-width="0.5"
                d="M12 2C7.03 2 3 6.03 3 11c0 6.25 9 15 9 15s9-8.75 9-15c0-4.97-4.03-9-9-9z"/>
              <circle cx="12" cy="11" r="3.5" fill="white"/>
            </svg>`,
            iconAnchor: [12, 40],
            popupAnchor: [0, -38]
        });

        // Custom deep blue marker (#0334c4)
        const blueCustomIcon = L.divIcon({
            className: "",
            html: `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="50" viewBox="0 0 24 40">
              <path fill="#0334c4" stroke="black" stroke-width="0.5"
                d="M12 2C7.03 2 3 6.03 3 11c0 6.25 9 15 9 15s9-8.75 9-15c0-4.97-4.03-9-9-9z"/>
              <circle cx="12" cy="11" r="3.5" fill="white"/>
            </svg>`,
            iconAnchor: [12, 40],
            popupAnchor: [0, -38]
        });

        // Highlight handling
        let activeRings = [];

        function clearHighlights() {
            activeRings.forEach(r => map.removeLayer(r));
            activeRings = [];
        }

        function highlightRegions(regionList) {
            clearHighlights();
            regionList.forEach(region => {
                if (regionCenters[region]) {
                    const ring = L.circle(regionCenters[region], {
                        radius: 80000,
                        color: '#fc2203',
                        fillColor: '#fca399',
                        fillOpacity: 0.5,
                        weight: 2
                    }).addTo(map);
                    activeRings.push(ring);
                }
            });
        }

        // Future Offices
        const futureOffices = [
            {
                name: "Future Satellite Office",
                coords: [-26.6486, 15.1572],
                highlightRegion: false,
                details: `<div><b>Planned Office Location:</b> Luderitz</div>`
            }
        ];

        futureOffices.forEach(f => {
            const marker = L.marker(f.coords, { icon: greenIcon }).addTo(map);
            marker.bindPopup(`<b>${f.name}</b><br>${f.details}`);
            marker.on('click', () => {
                clearHighlights();
                if (f.highlightRegion) {
                    highlightRegions(f.highlightRegion);
                } else {
                    const townCircle = L.circle(f.coords, {
                        radius: 80000,
                        color: 'green',
                        fillColor: '#00ff00',
                        fillOpacity: 0.5,
                        weight: 2
                    }).addTo(map);
                    activeRings.push(townCircle);
                }
            });
        });

        // Main Branches (Red markers)
        const branches = [
            {
                name: "Windhoek Branch",
                coords: [-22.56, 17.08],
                regions: ["Hardap", "Karas", "Omaheke", "Otjozondjupa", "Khomas"],
                details: `
        <div style="max-height:250px;overflow-y:auto;line-height:1.4;">
          <p><b>Technical Manager:</b> Mr. Meyer Nel</p>
          <p><b>Field Engineers:</b> 20<br>
          <b>Administrators:</b> 3<br>
          <b>Sales Consultants:</b> 7</p>
        </div>`
            },
            {
                name: "Walvis Bay Branch",
                coords: [-22.9576, 14.5056],
                regions: ["Erongo", "Kunene"],
                details: `
        <div style="max-height:250px;overflow-y:auto;line-height:1.4;">
          <p><b>Branch Manager:</b> Ms. Lucretia Fourie<br>
          <b>Field Engineers:</b> 2<br>
          <b>Administrative Assistants:</b> 1<br>
          <b>Sales Consultants:</b> 1</p>
        </div>`
            },
            {
                name: "Oshakati Branch",
                coords: [-17.7883, 15.7049],
                regions: ["Oshikoto", "Oshana", "Omusati", "Ohangwena", "Kavango West", "Kavango East"],
                details: `
        <div style="max-height:250px;overflow-y:auto;line-height:1.4;">
          <p><b>Branch Manager:</b> Mr. Gerhard Moolman<br>
          <b>Field Engineers:</b> 3<br>
          <b>Administrative Assistants:</b> 2<br>
          <b>Sales Consultants:</b> 1</p>
        </div>`
            }
        ];

        branches.forEach(b => {
            const marker = L.marker(b.coords, { icon: redIcon }).addTo(map);
            marker.bindPopup(`<b>${b.name}</b><br>${b.details}`);
            marker.on('click', () => highlightRegions(b.regions));
        });

        // Support Partners (Blue #0334c4 markers)
        const towns = [
            { name: "Support Partner", coords: [-24.6333, 17.9667], details: `<b>Mariental</b>` },
            { name: "Support Partner", coords: [-17.9167, 19.7667], details: `<b>Rundu</b>` },
            { name: "Support Partner", coords: [-17.5, 24.2667], details: `<b>Katima Mulilo</b>` },
            { name: "Support Partner", coords: [-26.5833, 18.1333], details: `<b>Keetmanshoop</b>` },
            { name: "Support Partner", coords: [-28.5667, 16.4333], details: `<b>Oranjemund</b>` },
            { name: "Support Partner", coords: [-20.4667, 17.0833], details: `<b>Otjiwarongo</b>` },
            {
                name: "Support Partner",
                coords: [-19.2333, 17.7167],
                supports: [{ name: "Grootfontein", coords: [-19.5667, 18.1167] }],
                details: `<b>Tsumeb</b><br>Supports Grootfontein`
            }
        ];

        towns.forEach(t => {
            const marker = L.marker(t.coords, { icon: blueCustomIcon }).addTo(map);
            marker.bindPopup(`<b>${t.name}</b><br>${t.details}`);
            marker.on('click', () => {
                clearHighlights();
                const townCircle = L.circle(t.coords, {
                    radius: 40000,
                    color: '#0334c4',
                    fillColor: '#0334c4',
                    fillOpacity: 0.3,
                    weight: 2
                }).addTo(map);
                activeRings.push(townCircle);
                if (t.supports) {
                    t.supports.forEach(s => {
                        const c = L.circle(s.coords, {
                            radius: 20000,
                            color: '#0334c4',
                            fillColor: '#0334c4',
                            fillOpacity: 0.3,
                            weight: 2
                        }).addTo(map);
                        activeRings.push(c);
                    });
                }
            });
        });

        // Dark Mode Toggle
        let darkMode = false;
        const btn = document.getElementById('toggleMode');
        btn.onclick = () => {
            if (!darkMode) {
                map.removeLayer(lightLayer);
                darkLayer.addTo(map);
                document.body.classList.add('dark-mode');
                btn.textContent = 'Switch to Light Mode';
            } else {
                map.removeLayer(darkLayer);
                lightLayer.addTo(map);
                document.body.classList.remove('dark-mode');
                btn.textContent = 'Switch to Dark Mode';
            }
            darkMode = !darkMode;
        };
    </script>
</body>

</html>
